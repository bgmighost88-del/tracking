<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تتبع صرف علاج وصفتي </title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #f7f9fb; }
        #medicationSuggestions::-webkit-scrollbar, #userSuggestions::-webkit-scrollbar { display: none; }
        #medicationSuggestions, #userSuggestions { -ms-overflow-style: none; scrollbar-width: none; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        input:disabled { background-color: #e5e7eb; cursor: not-allowed; }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        // ===================================================================================
        // الخطوة 1: إعداد Firebase
        // ===================================================================================
        const _0x57cfa9=_0x4d5f;(function(_0x3e32f2,_0x520b26){const _0x1957f7=_0x4d5f,_0x30f424=_0x3e32f2();while(!![]){try{const _0x3f7030=parseInt(_0x1957f7(0x1b8))/0x1+parseInt(_0x1957f7(0x1b9))/0x2*(-parseInt(_0x1957f7(0x218))/0x3)+-parseInt(_0x1957f7(0x17f))/0x4*(parseInt(_0x1957f7(0x194))/0x5)+-parseInt(_0x1957f7(0x1d9))/0x6+-parseInt(_0x1957f7(0x21d))/0x7+-parseInt(_0x1957f7(0x222))/0x8+parseInt(_0x1957f7(0x1e2))/0x9;if(_0x3f7030===_0x520b26)break;else _0x30f424['push'](_0x30f424['shift']());}catch(_0x421d96){_0x30f424['push'](_0x30f424['shift']());}}}(_0x5629,0xa2e7a));const firebaseConfig={'apiKey':_0x57cfa9(0x1ff),'authDomain':_0x57cfa9(0x1ec),'projectId':_0x57cfa9(0x1e3),'storageBucket':_0x57cfa9(0x1a4),'messagingSenderId':_0x57cfa9(0x1ef),'appId':_0x57cfa9(0x20f)};import{initializeApp}from'https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js';import{getAuth,onAuthStateChanged,signInWithEmailAndPassword,signOut}from'https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js';function _0x5629(){const _0x592ea1=['8532545LoyNrU','حفظ\x20سجل\x20صرف\x20جديد','cancelDeleteButton','confirmDeleteRecord','bg-white\x20border-b\x20hover:bg-gray-50','2508416QLEJjk','appendChild','messageBox','<span\x20class=\x22inline-block\x20bg-gray-200\x20text-gray-800\x20text-xs\x20px-2\x20py-0.5\x20rounded-full\x20m-0.5\x22>','p-3\x20mb-4\x20text-sm\x20rounded-lg\x20shadow-md\x20transition-all\x20duration-300','phoneNumber','clearSearchButton','email','loginContainer','textContent','records','input','</td><td\x20class=\x22px-4\x20py-3\x20text-center\x20','\x27)\x22\x20class=\x22bg-red-500\x20hover:bg-red-600\x20text-white\x20text-xs\x20font-bold\x20py-1\x20px-3\x20rounded-full\x22>حذف</button></td>','بيانات\x20المريض\x20إلزامية\x20للوصفة\x20الجديدة.','padStart','toISOString','durationDays','رقم\x20وصفة\x20جديد.\x20يرجى\x20إدخال\x20جميع\x20البيانات.','closeHistoryModalButton','تم\x20حذف\x20السجل\x20بنجاح.','1465572gWEajK','<td\x20class=\x22px-6\x20py-4\x20font-semibold\x20text-purple-700\x22>','some','</td><td\x20class=\x22px-4\x20py-3\x22>','<span\x20class=\x22inline-block\x20bg-blue-100\x20text-blue-800\x20text-xs\x20font-medium\x20px-2.5\x20py-0.5\x20rounded-full\x20m-0.5\x22>','وصفة\x20سابقة.\x20يمكنك\x20تعديل\x20الأدوية\x20أو\x20تسجيل\x20الصرف.','reportModal','slice','map','prescriptionNumber','startDateFilter','createdByHeader','endDateFilter','error','bg-green-50\x20font-semibold','contains','docs','confirmDeleteMessage','split','replace','</td><td\x20class=\x22px-6\x20py-4\x22>','10JOSfww','toLowerCase','key','bg-blue-100\x20text-blue-700','لا\x20يوجد','forEach','classList','selectedMedicationsContainer','Submit\x20Error:','<div\x20class=\x22loader\x20mx-auto\x22></div>','target','خطأ:\x20','submit','noResultsReport','setDate','حدث\x20خطأ\x20أثناء\x20محاولة\x20الحذف.','wasfatytracking.firebasestorage.app','medications','سجل\x20إعادة\x20صرف\x20(','modalRecordsBody','</span>','sort','bg-red-100\x20text-red-700','click','Delete\x20Error:','includes','\x27,\x20\x27','N/A','div','\x27)\x22\x20class=\x22bg-blue-500\x20hover:bg-blue-600\x20text-white\x20text-xs\x20py-1\x20px-3\x20rounded-full\x22>عرض\x20(','Toujeo','<span\x20class=\x22inline-block\x20bg-blue-100\x20text-blue-800\x20text-xs\x20px-2.5\x20py-0.5\x20rounded-full\x20m-0.5\x22>','find','bg-white\x20hover:bg-gray-50','resultsModal','confirmDeleteButton','238555wZOFTJ','2CfibHN','#medicationInputArea','medicationSuggestions','getFullYear','noResultsModal','currentUser','Novomix','availableMedications','appContainer','onload','getElementById','refillDate','splice','red','يرجى\x20ملء\x20الحقول\x20الإلزامية.','يجب\x20اختيار\x20علاج\x20واحد\x20على\x20الأقل.','value','text-green-600',')\x22><svg\x20class=\x22w-4\x20h-4\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20viewBox=\x220\x200\x2024\x2024\x22><path\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20stroke-width=\x222\x22\x20d=\x22M6\x2018L18\x206M6\x206l12\x2012\x22></path></svg></button></div>','w-full\x20flex\x20justify-center\x20items-center\x20py-3\x20px-4\x20rounded-lg\x20shadow-md\x20text-white\x20bg-blue-900\x20hover:bg-blue-700','showDispensingHistory','getMonth','startsWith','text-red-600','className','bg-green-100\x20text-green-700','blue','refillDateDisplay','flex','elements','</td><td\x20class=\x22px-6\x20py-4\x20font-bold\x22>','userInfo','6748962Xsitlg','focus','refillDuration','<td\x20class=\x22px-6\x20py-4\x20text-center\x22><button\x20onclick=\x22showDispensingHistory(\x27','yellow','remove','addEventListener','innerHTML','historyPatientName','35788986ZfPloF','wasfatytracking','dispensingHistory','filter','generalSearchFilter','loginError','<p\x20class=\x22text-sm\x20text-gray-400\x22>لم\x20يتم\x20اختيار\x20أي\x20علاج\x20بعد.</p>','Escape','تم\x20تسجيل\x20إعادة\x20الصرف\x20بنجاح!','idNumber','wasfatytracking.firebaseapp.com','@pharmacy.com','<td\x20class=\x22px-4\x20py-3\x22>','580236981063','confirmDeleteModal','w-full\x20flex\x20justify-center\x20items-center\x20py-3\x20px-4\x20rounded-lg\x20shadow-md\x20text-white\x20bg-green-600\x20hover:bg-green-700','createElement','length','keypress','Novorapid','logoutButton','medicationFilter','هل\x20أنت\x20متأكد\x20من\x20حذف\x20وصفة\x20المريض:\x20','checkPrescriptionButton','removeMedication','getDate','hidden','toggle','اسم\x20المستخدم\x20أو\x20كلمة\x20المرور\x20غير\x20صحيحة.','AIzaSyBshSGBdGiiCMtqC3Z16_w6xWPfv-xjTq8','searchButton','trim','text-gray-500','preventDefault','تم\x20حفظ\x20السجل\x20الجديد\x20بنجاح!','passwordInput','Sensor','add','closeReportModalButton','؟\x20لا\x20يمكن\x20التراجع\x20عن\x20هذا\x20الإجراء.','usernameInput','push','join','disabled','green','1:580236981063:web:bac34b55427f3450b89262','closeModalButton','historyModal','randomUUID','admin@','</td><td\x20class=\x22px-6\x20py-4\x20font-bold\x20','addMedicationButton','submitButton','dispensingDate','473253EkQfQk','Error\x20loading\x20meds:','patientName','--\x20/\x20--\x20/\x20----','noRefillReportButton'];_0x5629=function(){return _0x592ea1;};return _0x5629();}import{getFirestore,collection,doc,addDoc,updateDoc,deleteDoc,onSnapshot,getDocs,setDoc,query}from'https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js';const app=initializeApp(firebaseConfig),db=getFirestore(app),auth=getAuth(app);let records=[],currentMedications=[],currentRecord=null,AVAILABLE_MEDICATIONS=[],unsubscribeFromRecords=null,recordIdToDelete=null;const loginContainer=()=>document['getElementById'](_0x57cfa9(0x22a)),appContainer=()=>document[_0x57cfa9(0x1c3)](_0x57cfa9(0x1c1)),showApp=_0x1fc6b5=>{const _0x5825a8=_0x57cfa9;loginContainer()[_0x5825a8(0x19a)][_0x5825a8(0x207)]('hidden'),appContainer()[_0x5825a8(0x19a)][_0x5825a8(0x1de)](_0x5825a8(0x1fc)),document[_0x5825a8(0x1c3)]('loggedInUserDisplay')[_0x5825a8(0x22b)]=_0x1fc6b5[_0x5825a8(0x229)]['split']('@')[0x0],document[_0x5825a8(0x1c3)](_0x5825a8(0x1d8))['classList'][_0x5825a8(0x1de)](_0x5825a8(0x1fc));},showLogin=()=>{const _0x3d335a=_0x57cfa9;appContainer()['classList'][_0x3d335a(0x207)]('hidden'),loginContainer()['classList'][_0x3d335a(0x1de)](_0x3d335a(0x1fc)),document[_0x3d335a(0x1c3)](_0x3d335a(0x1d8))['classList'][_0x3d335a(0x207)](_0x3d335a(0x1fc));},handleLogout=async()=>{await signOut(auth);},handleLogin=async _0x5e5995=>{const _0x32e53d=_0x57cfa9;_0x5e5995['preventDefault']();const _0x452053=document[_0x32e53d(0x1c3)](_0x32e53d(0x20a))['value'][_0x32e53d(0x201)](),_0x2bedf0=_0x452053+_0x32e53d(0x1ed),_0x471e0f=document[_0x32e53d(0x1c3)](_0x32e53d(0x205))['value'],_0x2010dd=document[_0x32e53d(0x1c3)](_0x32e53d(0x1e7));_0x2010dd[_0x32e53d(0x19a)][_0x32e53d(0x207)]('hidden');try{await signInWithEmailAndPassword(auth,_0x2bedf0,_0x471e0f);}catch(_0x8b5053){_0x2010dd[_0x32e53d(0x22b)]=_0x32e53d(0x1fe),_0x2010dd['classList']['remove'](_0x32e53d(0x1fc));}};onAuthStateChanged(auth,_0x356d5a=>{if(_0x356d5a)showApp(_0x356d5a),initApp();else{showLogin();if(unsubscribeFromRecords)unsubscribeFromRecords();records=[];}});function _0x4d5f(_0x2161ba,_0x433cd9){const _0x562910=_0x5629();return _0x4d5f=function(_0x4d5ff5,_0x50cdcd){_0x4d5ff5=_0x4d5ff5-0x179;let _0x50be72=_0x562910[_0x4d5ff5];return _0x50be72;},_0x4d5f(_0x2161ba,_0x433cd9);}const loadAvailableMedsFromFirestore=async()=>{const _0x17247d=_0x57cfa9;try{const _0xeeae89=await getDocs(collection(db,_0x17247d(0x1c0)));AVAILABLE_MEDICATIONS=_0xeeae89[_0x17247d(0x18f)][_0x17247d(0x187)](_0x13b200=>_0x13b200['id'])[_0x17247d(0x1a9)]((_0x1807ad,_0x18b249)=>_0x1807ad['localeCompare'](_0x18b249,'ar'));}catch(_0x226cf6){console['error'](_0x17247d(0x219),_0x226cf6),AVAILABLE_MEDICATIONS=[_0x17247d(0x206),_0x17247d(0x1f5),'Lantus',_0x17247d(0x1bf),_0x17247d(0x1b2)];}},listenForRecords=()=>{const _0x46a182=_0x57cfa9;if(unsubscribeFromRecords)unsubscribeFromRecords();unsubscribeFromRecords=onSnapshot(query(collection(db,_0x46a182(0x22c))),_0x550d66=>{const _0x27559c=_0x46a182;records=_0x550d66[_0x27559c(0x18f)][_0x27559c(0x187)](_0x4d0a3a=>({'id':_0x4d0a3a['id'],..._0x4d0a3a['data']()}));},console[_0x46a182(0x18c)]);},addMedicationToFirestore=async _0x3b61a5=>{const _0x44fddf=_0x57cfa9;try{await setDoc(doc(db,_0x44fddf(0x1c0),_0x3b61a5),{'name':_0x3b61a5});}catch(_0x3d18bc){console[_0x44fddf(0x18c)]('Error\x20adding\x20med:',_0x3d18bc);}},initApp=async()=>{const _0x395368=_0x57cfa9;document[_0x395368(0x1c3)]('loadingStatus')[_0x395368(0x1e0)]='',await loadAvailableMedsFromFirestore(),listenForRecords(),setupSearchableDropdown(),calculateRefillDate(),renderCurrentMedications(),resetFormState(!![]);},getLatestDispensing=_0x522acd=>{const _0x4e2b40=_0x57cfa9;if(!_0x522acd?.[_0x4e2b40(0x1e4)]?.['length'])return null;return[..._0x522acd['dispensingHistory']][_0x4e2b40(0x1a9)]((_0x315f51,_0x580252)=>new Date(_0x580252['dispensingDate'])-new Date(_0x315f51['dispensingDate']))[0x0];},showModal=_0x77256e=>{const _0x48ae24=_0x57cfa9;document[_0x48ae24(0x1c3)](_0x77256e)[_0x48ae24(0x19a)][_0x48ae24(0x192)](_0x48ae24(0x1fc),'flex');},closeModal=_0x49c663=>{const _0x2ed3c3=_0x57cfa9;document['getElementById'](_0x49c663)[_0x2ed3c3(0x19a)][_0x2ed3c3(0x192)](_0x2ed3c3(0x1d5),'hidden');};window[_0x57cfa9(0x1cd)]=_0x4c98c3=>{const _0x4412d5=_0x57cfa9,_0x26ce71=records[_0x4412d5(0x1b4)](_0x40f3e5=>_0x40f3e5['id']===_0x4c98c3);if(!_0x26ce71)return;const _0x1819b7=document['getElementById']('historyModalBody'),_0x4d9f61=document[_0x4412d5(0x1c3)](_0x4412d5(0x1e1)),_0x3ec54e=[..._0x26ce71[_0x4412d5(0x1e4)]][_0x4412d5(0x1a9)]((_0x10b37a,_0x3c7518)=>new Date(_0x3c7518['dispensingDate'])-new Date(_0x10b37a[_0x4412d5(0x217)]));_0x1819b7[_0x4412d5(0x1e0)]='',_0x4d9f61[_0x4412d5(0x22b)]=_0x26ce71[_0x4412d5(0x21a)],_0x3ec54e[_0x4412d5(0x199)]((_0x2199f5,_0x4205cb)=>{const _0x2943d5=_0x4412d5,_0x182c70=_0x4205cb===0x0,_0x500f3e=_0x2199f5['medications']||_0x26ce71[_0x2943d5(0x1a5)]||[],_0xf23415=_0x500f3e[_0x2943d5(0x187)](_0x4a5388=>_0x2943d5(0x183)+_0x4a5388+_0x2943d5(0x1a8))[_0x2943d5(0x20c)](''),_0x101ca6=_0x2199f5[_0x2943d5(0x1c4)]==='N/A'?'لا\x20يوجد':_0x2199f5[_0x2943d5(0x1c4)],_0x59d8e6=document['createElement']('tr');_0x59d8e6['className']='border-b\x20'+(_0x182c70?_0x2943d5(0x18d):_0x2943d5(0x1b5)),_0x59d8e6[_0x2943d5(0x1e0)]='<td\x20class=\x22px-4\x20py-3\x20text-center\x22>'+(_0x3ec54e['length']-_0x4205cb)+'</td><td\x20class=\x22px-4\x20py-3\x20text-center\x22>'+_0x2199f5[_0x2943d5(0x217)]+'</td><td\x20class=\x22px-4\x20py-3\x20text-center\x22>'+(_0x2199f5[_0x2943d5(0x17b)]>0x0?_0x2199f5[_0x2943d5(0x17b)]+'\x20يوم':_0x2943d5(0x1af))+_0x2943d5(0x22e)+(!_0x182c70&&_0x2199f5[_0x2943d5(0x1c4)]!==_0x2943d5(0x1af)?_0x2943d5(0x1ca):'')+'\x22>'+_0x101ca6+_0x2943d5(0x182)+_0xf23415+'</td>',_0x1819b7[_0x2943d5(0x223)](_0x59d8e6);}),showModal('historyModal');};const displayRecords=_0x4a030f=>{const _0x2a7f8f=_0x57cfa9,_0x53c647=document[_0x2a7f8f(0x1c3)](_0x2a7f8f(0x1a7)),_0x5653ab=document[_0x2a7f8f(0x1c3)](_0x2a7f8f(0x1bd)),_0x286072=auth[_0x2a7f8f(0x1be)][_0x2a7f8f(0x229)],_0x23f3ca=document[_0x2a7f8f(0x1c3)](_0x2a7f8f(0x18a));_0x53c647[_0x2a7f8f(0x1e0)]='';const _0x13e99f=_0x286072['toLowerCase']()[_0x2a7f8f(0x1cf)](_0x2a7f8f(0x213));_0x23f3ca[_0x2a7f8f(0x19a)]['toggle']('hidden',!_0x13e99f),_0x4a030f[_0x2a7f8f(0x1a9)]((_0xc059c9,_0x1db8ef)=>new Date(getLatestDispensing(_0x1db8ef)?.['dispensingDate']||0x0)-new Date(getLatestDispensing(_0xc059c9)?.['dispensingDate']||0x0)),_0x5653ab['classList'][_0x2a7f8f(0x1fd)]('hidden',_0x4a030f['length']>0x0),_0x4a030f[_0x2a7f8f(0x1f3)]>0x0&&_0x4a030f[_0x2a7f8f(0x199)](_0x2c9bbc=>{const _0x537536=_0x2a7f8f,_0x1bf58f=getLatestDispensing(_0x2c9bbc),_0x4c055f=_0x1bf58f?.[_0x537536(0x217)]||_0x537536(0x1af),_0x205f56=_0x1bf58f?.[_0x537536(0x1c4)]||_0x537536(0x1af),_0x338d0e=_0x205f56===_0x537536(0x1af)?_0x537536(0x198):_0x205f56,_0x75bb5a=new Date(_0x205f56)<new Date()&&_0x205f56!=='N/A'?_0x537536(0x1d0):_0x537536(0x1ca),_0x2c8294=(_0x2c9bbc[_0x537536(0x1a5)]||[])[_0x537536(0x187)](_0x1b595e=>_0x537536(0x1b3)+_0x1b595e+_0x537536(0x1a8))[_0x537536(0x20c)](''),_0x10db19=_0x13e99f?_0x537536(0x180)+(_0x2c9bbc['createdBy']||_0x537536(0x1af))[_0x537536(0x191)]('@')[0x0]+'</td>':'',_0x5b753e=document[_0x537536(0x1f2)]('tr');_0x5b753e['className']=_0x537536(0x221),_0x5b753e[_0x537536(0x1e0)]='<td\x20class=\x22px-6\x20py-4\x22>'+_0x2c9bbc[_0x537536(0x21a)]+'</td><td\x20class=\x22px-6\x20py-4\x22>'+_0x2c9bbc[_0x537536(0x1eb)]+_0x537536(0x193)+(_0x2c9bbc[_0x537536(0x227)]||_0x537536(0x1af))+_0x537536(0x1d7)+_0x2c9bbc[_0x537536(0x188)]+_0x537536(0x193)+_0x2c8294+_0x537536(0x193)+_0x4c055f+_0x537536(0x214)+(_0x205f56==='N/A'?_0x537536(0x202):_0x75bb5a)+'\x22>'+_0x338d0e+'</td>'+_0x10db19+_0x537536(0x1dc)+_0x2c9bbc['id']+_0x537536(0x1b1)+_0x2c9bbc[_0x537536(0x1e4)]['length']+')</button></td>',_0x53c647[_0x537536(0x223)](_0x5b753e);}),showModal(_0x2a7f8f(0x1b6));},renderCurrentMedications=(_0x155e52=currentMedications)=>{const _0x14f6d1=_0x57cfa9,_0x1ad825=document['getElementById'](_0x14f6d1(0x19b));_0x1ad825[_0x14f6d1(0x1e0)]=_0x155e52[_0x14f6d1(0x1f3)]===0x0?_0x14f6d1(0x1e8):_0x155e52[_0x14f6d1(0x187)]((_0x18475e,_0x1345b6)=>'<div\x20class=\x22inline-flex\x20items-center\x20px-3\x20py-1\x20m-1\x20text-sm\x20bg-blue-100\x20text-blue-800\x20rounded-full\x22><span>'+_0x18475e+'</span><button\x20type=\x22button\x22\x20class=\x22rtl:mr-2\x20ltr:ml-2\x20text-blue-500\x20hover:text-blue-700\x22\x20onclick=\x22removeMedication('+_0x1345b6+_0x14f6d1(0x1cb))[_0x14f6d1(0x20c)](''),document[_0x14f6d1(0x1c3)]('medicationCount')[_0x14f6d1(0x1c9)]=_0x155e52['length'];};window[_0x57cfa9(0x1fa)]=_0x50ef5f=>{const _0x2a2b58=_0x57cfa9;currentMedications[_0x2a2b58(0x1c5)](_0x50ef5f,0x1),renderCurrentMedications();};const addMedication=_0xdd3f82=>{const _0x2daede=_0x57cfa9,_0x383cd8=_0xdd3f82[_0x2daede(0x201)]();if(!_0x383cd8)return;!AVAILABLE_MEDICATIONS[_0x2daede(0x181)](_0x3035d6=>_0x3035d6[_0x2daede(0x195)]()===_0x383cd8[_0x2daede(0x195)]())&&(AVAILABLE_MEDICATIONS[_0x2daede(0x20b)](_0x383cd8),AVAILABLE_MEDICATIONS['sort']((_0x359428,_0x264aab)=>_0x359428['localeCompare'](_0x264aab,'ar')),addMedicationToFirestore(_0x383cd8)),!currentMedications[_0x2daede(0x1ad)](_0x383cd8)&&currentMedications[_0x2daede(0x20b)](_0x383cd8),document['getElementById']('medicationSearch')[_0x2daede(0x1c9)]='',renderCurrentMedications(),document[_0x2daede(0x1c3)](_0x2daede(0x1bb))[_0x2daede(0x19a)][_0x2daede(0x207)](_0x2daede(0x1fc));},setupSearchableDropdown=()=>{const _0x44545b=_0x57cfa9,_0x2edebd=document[_0x44545b(0x1c3)]('medicationSearch'),_0x32deee=document[_0x44545b(0x1c3)](_0x44545b(0x1bb)),_0x2fde44=document[_0x44545b(0x1c3)](_0x44545b(0x215)),_0x5a1817=()=>{const _0x97caa8=_0x44545b,_0x2449d2=_0x2edebd[_0x97caa8(0x1c9)][_0x97caa8(0x201)]()['toLowerCase']();_0x32deee[_0x97caa8(0x1e0)]='';if(!_0x2449d2){_0x32deee[_0x97caa8(0x19a)][_0x97caa8(0x207)](_0x97caa8(0x1fc));return;}const _0x4b8213=AVAILABLE_MEDICATIONS[_0x97caa8(0x1e5)](_0x3d8db1=>_0x3d8db1[_0x97caa8(0x195)]()[_0x97caa8(0x1ad)](_0x2449d2))[_0x97caa8(0x186)](0x0,0xa);_0x32deee[_0x97caa8(0x19a)][_0x97caa8(0x1fd)](_0x97caa8(0x1fc),_0x4b8213[_0x97caa8(0x1f3)]===0x0),_0x4b8213[_0x97caa8(0x1f3)]>0x0&&_0x4b8213[_0x97caa8(0x199)](_0xafe419=>{const _0x1b3d6b=_0x97caa8,_0x2b4163=document[_0x1b3d6b(0x1f2)](_0x1b3d6b(0x1b0));_0x2b4163[_0x1b3d6b(0x1d1)]='px-4\x20py-2\x20cursor-pointer\x20hover:bg-blue-100\x20text-sm',_0x2b4163['textContent']=_0xafe419,_0x2b4163['onclick']=()=>{addMedication(_0xafe419);},_0x32deee[_0x1b3d6b(0x223)](_0x2b4163);});};_0x2edebd['addEventListener'](_0x44545b(0x22d),_0x5a1817),_0x2fde44['addEventListener'](_0x44545b(0x1ab),()=>{const _0x444f43=_0x44545b;addMedication(_0x2edebd[_0x444f43(0x1c9)]);}),_0x2edebd['addEventListener'](_0x44545b(0x1f4),_0xf96c1d=>{const _0x424806=_0x44545b;_0xf96c1d['key']==='Enter'&&(_0xf96c1d[_0x424806(0x203)](),addMedication(_0x2edebd['value']));}),document[_0x44545b(0x1df)](_0x44545b(0x1ab),_0x34de8e=>{const _0x2497f0=_0x44545b;!_0x34de8e[_0x2497f0(0x19e)]['closest'](_0x2497f0(0x1ba))&&_0x32deee[_0x2497f0(0x19a)][_0x2497f0(0x207)](_0x2497f0(0x1fc));});},checkPrescription=()=>{const _0x522096=_0x57cfa9,_0x5b052f=document[_0x522096(0x1c3)](_0x522096(0x188))[_0x522096(0x1c9)][_0x522096(0x201)]();if(!_0x5b052f){resetFormState(!![]);return;}const _0x595c58=records['find'](_0x2b87c8=>_0x2b87c8[_0x522096(0x188)]===_0x5b052f);_0x595c58?(currentRecord=_0x595c58,[_0x522096(0x21a),_0x522096(0x1eb),_0x522096(0x227)][_0x522096(0x199)](_0x97072f=>{const _0x53acdb=_0x522096,_0x49fb4b=document[_0x53acdb(0x1c3)](_0x97072f);_0x49fb4b[_0x53acdb(0x1c9)]=_0x595c58[_0x97072f]||'',_0x49fb4b[_0x53acdb(0x20d)]=!![];}),currentMedications=[..._0x595c58[_0x522096(0x1a5)]||[]],renderCurrentMedications(),document['getElementById'](_0x522096(0x216))['textContent']=_0x522096(0x1a6)+(_0x595c58[_0x522096(0x1e4)][_0x522096(0x1f3)]+0x1)+')',document[_0x522096(0x1c3)]('submitButton')['className']=_0x522096(0x1f1),showMessage(_0x522096(0x184),_0x522096(0x1dd)),document[_0x522096(0x1c3)](_0x522096(0x217))[_0x522096(0x1da)]()):(resetFormState(![],_0x5b052f),showMessage(_0x522096(0x17c),_0x522096(0x1d3)));},resetFormState=(_0x30355d=![],_0x12a520='')=>{const _0x326764=_0x57cfa9;currentRecord=null,['patientName',_0x326764(0x1eb),'phoneNumber'][_0x326764(0x199)](_0x381810=>{const _0x4854a9=_0x326764,_0x31f72c=document[_0x4854a9(0x1c3)](_0x381810);_0x31f72c[_0x4854a9(0x20d)]=![];if(_0x30355d)_0x31f72c['value']='';}),_0x30355d&&(currentMedications=[],document[_0x326764(0x1c3)]('medicationSearch')[_0x326764(0x1c9)]='',renderCurrentMedications()),document[_0x326764(0x1c3)]('submitButton')[_0x326764(0x22b)]=_0x326764(0x21e),document[_0x326764(0x1c3)]('submitButton')['className']=_0x326764(0x1cc),document[_0x326764(0x1c3)](_0x326764(0x188))[_0x326764(0x1c9)]=_0x30355d?'':_0x12a520,document['getElementById'](_0x326764(0x217))['value']='',document['getElementById']('refillDuration')[_0x326764(0x1c9)]='',calculateRefillDate();},formatDate=_0x473ee2=>_0x473ee2[_0x57cfa9(0x1bc)]()+'-'+String(_0x473ee2[_0x57cfa9(0x1ce)]()+0x1)[_0x57cfa9(0x179)](0x2,'0')+'-'+String(_0x473ee2[_0x57cfa9(0x1fb)]())[_0x57cfa9(0x179)](0x2,'0'),calculateRefillDate=()=>{const _0x24ee82=_0x57cfa9,_0x3bb49f=document[_0x24ee82(0x1c3)]('dispensingDate')[_0x24ee82(0x1c9)],_0x44a4da=document['getElementById'](_0x24ee82(0x1db))['value'],_0x38e1ee=document['getElementById'](_0x24ee82(0x1c4)),_0x57a56d=document['getElementById'](_0x24ee82(0x1d4));if(!_0x3bb49f||_0x44a4da===''){_0x38e1ee[_0x24ee82(0x1c9)]='',_0x57a56d['textContent']=_0x24ee82(0x21b);return;}if(_0x44a4da==='0'){_0x38e1ee[_0x24ee82(0x1c9)]=_0x24ee82(0x1af),_0x57a56d['textContent']='لا\x20يوجد\x20إعادة\x20صرف';return;}const _0x4023da=new Date(_0x3bb49f);_0x4023da[_0x24ee82(0x1a2)](_0x4023da[_0x24ee82(0x1fb)]()+parseInt(_0x44a4da,0xa)),_0x38e1ee[_0x24ee82(0x1c9)]=formatDate(_0x4023da),_0x57a56d[_0x24ee82(0x22b)]=formatDate(_0x4023da);},filterRecords=()=>{const _0x49fe11=_0x57cfa9,_0x534853=auth[_0x49fe11(0x1be)][_0x49fe11(0x229)];let _0xba061b=_0x534853[_0x49fe11(0x195)]()[_0x49fe11(0x1cf)](_0x49fe11(0x213))?records:records[_0x49fe11(0x1e5)](_0x11ed9e=>_0x11ed9e['createdBy']===_0x534853);const _0x1120c5=document[_0x49fe11(0x1c3)](_0x49fe11(0x189))[_0x49fe11(0x1c9)],_0x2b6e65=document[_0x49fe11(0x1c3)](_0x49fe11(0x18b))['value'],_0x3348a5=document[_0x49fe11(0x1c3)](_0x49fe11(0x1f7))[_0x49fe11(0x1c9)][_0x49fe11(0x201)]()[_0x49fe11(0x195)](),_0x2431dd=document[_0x49fe11(0x1c3)](_0x49fe11(0x1e6))[_0x49fe11(0x1c9)][_0x49fe11(0x201)]()[_0x49fe11(0x195)]();if(_0x1120c5&&_0x2b6e65&&_0x1120c5>_0x2b6e65){alert('تاريخ\x20البداية\x20يجب\x20أن\x20يكون\x20قبل\x20تاريخ\x20النهاية.');return;}const _0x2fb6ca=_0xba061b[_0x49fe11(0x1e5)](_0x52df68=>{const _0x20322c=_0x49fe11,_0x2750e4=getLatestDispensing(_0x52df68);if(!_0x2750e4)return![];if(_0x1120c5&&(_0x2750e4[_0x20322c(0x1c4)]<_0x1120c5||_0x2750e4[_0x20322c(0x1c4)]===_0x20322c(0x1af)))return![];if(_0x2b6e65&&(_0x2750e4['refillDate']>_0x2b6e65||_0x2750e4[_0x20322c(0x1c4)]===_0x20322c(0x1af)))return![];if(_0x3348a5&&!(_0x52df68[_0x20322c(0x1a5)]||[])[_0x20322c(0x181)](_0x2065ca=>_0x2065ca[_0x20322c(0x195)]()['includes'](_0x3348a5)))return![];if(_0x2431dd&&!(_0x52df68[_0x20322c(0x1eb)]?.[_0x20322c(0x1ad)](_0x2431dd)||_0x52df68[_0x20322c(0x227)]?.[_0x20322c(0x1ad)](_0x2431dd)||_0x52df68[_0x20322c(0x188)]?.[_0x20322c(0x195)]()[_0x20322c(0x1ad)](_0x2431dd)))return![];return!![];});displayRecords(_0x2fb6ca);},clearSearch=()=>{const _0x29ea8f=_0x57cfa9;[_0x29ea8f(0x189),_0x29ea8f(0x18b),'medicationFilter','generalSearchFilter']['forEach'](_0x91df25=>document[_0x29ea8f(0x1c3)](_0x91df25)['value']=''),closeModal(_0x29ea8f(0x1b6));},handleFormSubmit=async _0x3e2c36=>{const _0x421946=_0x57cfa9;_0x3e2c36['preventDefault']();const _0x3471ef=_0x3e2c36[_0x421946(0x19e)],{prescriptionNumber:_0x33e0f9,dispensingDate:_0x1c815f,refillDuration:_0x15c5a5,medicationCount:_0x578485,patientName:_0x2ffb5e,idNumber:_0x2efcaa,phoneNumber:_0x2a6356}=_0x3471ef[_0x421946(0x1d6)];if(!_0x33e0f9[_0x421946(0x1c9)][_0x421946(0x201)]()||!_0x1c815f[_0x421946(0x1c9)]||_0x15c5a5[_0x421946(0x1c9)]==='')return showMessage(_0x421946(0x1c7),'yellow');if(parseInt(_0x578485[_0x421946(0x1c9)],0xa)===0x0)return showMessage(_0x421946(0x1c8),_0x421946(0x1dd));const _0x4b49dc=document[_0x421946(0x1c3)](_0x421946(0x216)),_0x343ef2=_0x4b49dc['innerHTML'];_0x4b49dc[_0x421946(0x20d)]=!![],_0x4b49dc[_0x421946(0x1e0)]=_0x421946(0x19d);try{const _0xb5d211={'dispensingID':crypto[_0x421946(0x212)](),'dispensingDate':_0x3471ef[_0x421946(0x1d6)][_0x421946(0x217)][_0x421946(0x1c9)],'refillDate':_0x3471ef[_0x421946(0x1d6)][_0x421946(0x1c4)][_0x421946(0x1c9)],'durationDays':parseInt(_0x15c5a5[_0x421946(0x1c9)],0xa),'transactionTime':new Date()[_0x421946(0x17a)](),'medications':[...currentMedications]};if(currentRecord){const _0x50bf61=doc(db,'records',currentRecord['id']);await updateDoc(_0x50bf61,{'medications':[...currentMedications],'dispensingHistory':[...currentRecord[_0x421946(0x1e4)],_0xb5d211]}),showMessage(_0x421946(0x1ea),_0x421946(0x20e));}else{if(!_0x2ffb5e['value'][_0x421946(0x201)]()||!_0x2efcaa[_0x421946(0x1c9)]['trim']()||!_0x2a6356[_0x421946(0x1c9)]['trim']())throw new Error(_0x421946(0x230));const _0x5cdee1={'patientName':_0x2ffb5e[_0x421946(0x1c9)][_0x421946(0x201)](),'idNumber':_0x2efcaa[_0x421946(0x1c9)]['trim'](),'phoneNumber':_0x2a6356['value'][_0x421946(0x201)](),'prescriptionNumber':_0x33e0f9[_0x421946(0x1c9)]['trim'](),'medications':[...currentMedications],'dispensingHistory':[_0xb5d211],'createdAt':new Date()['toISOString'](),'createdBy':auth['currentUser'][_0x421946(0x229)]};await addDoc(collection(db,_0x421946(0x22c)),_0x5cdee1),showMessage(_0x421946(0x204),_0x421946(0x20e));}resetFormState(!![]);}catch(_0x187d84){console[_0x421946(0x18c)](_0x421946(0x19c),_0x187d84),showMessage(_0x421946(0x19f)+_0x187d84['message'],_0x421946(0x1c6));}finally{_0x4b49dc['disabled']=![],_0x4b49dc[_0x421946(0x1e0)]=_0x343ef2;}},showMessage=(_0x2e7351,_0x3dc956)=>{const _0x4d39be=_0x57cfa9,_0x214f2b=document['getElementById'](_0x4d39be(0x224));_0x214f2b[_0x4d39be(0x22b)]=_0x2e7351,_0x214f2b['className']=_0x4d39be(0x226);const _0x2a7cc5={'green':_0x4d39be(0x1d2),'yellow':'bg-yellow-100\x20text-yellow-700','red':_0x4d39be(0x1aa),'blue':_0x4d39be(0x197)};_0x214f2b[_0x4d39be(0x19a)][_0x4d39be(0x207)](...(_0x2a7cc5[_0x3dc956]||'')[_0x4d39be(0x191)]('\x20'));},showNoRefillReport=()=>{const _0x134b24=_0x57cfa9,_0x2a9f01=records[_0x134b24(0x1e5)](_0xe6e203=>getLatestDispensing(_0xe6e203)?.[_0x134b24(0x17b)]===0x0),_0x99e90a=document['getElementById']('reportModalBody'),_0x4606bb=document[_0x134b24(0x1c3)](_0x134b24(0x1a1));_0x99e90a['innerHTML']='',_0x4606bb[_0x134b24(0x19a)][_0x134b24(0x1fd)](_0x134b24(0x1fc),_0x2a9f01[_0x134b24(0x1f3)]>0x0),_0x2a9f01[_0x134b24(0x1f3)]>0x0&&_0x2a9f01['forEach'](_0x5481ed=>{const _0x53c8b1=_0x134b24,_0x55b6cc=getLatestDispensing(_0x5481ed),_0x31d5ad=(_0x5481ed[_0x53c8b1(0x1a5)]||[])['map'](_0x551e97=>_0x53c8b1(0x225)+_0x551e97+_0x53c8b1(0x1a8))['join'](''),_0x54d446=document[_0x53c8b1(0x1f2)]('tr');_0x54d446[_0x53c8b1(0x1d1)]=_0x53c8b1(0x221),_0x54d446[_0x53c8b1(0x1e0)]=_0x53c8b1(0x1ee)+_0x5481ed[_0x53c8b1(0x21a)]+_0x53c8b1(0x182)+_0x5481ed[_0x53c8b1(0x1eb)]+'</td><td\x20class=\x22px-4\x20py-3\x20font-semibold\x22>'+_0x5481ed['prescriptionNumber']+_0x53c8b1(0x182)+_0x31d5ad+_0x53c8b1(0x182)+_0x55b6cc[_0x53c8b1(0x217)]+'</td><td\x20class=\x22px-4\x20py-3\x20text-center\x22><button\x20onclick=\x22confirmDeleteRecord(\x27'+_0x5481ed['id']+_0x53c8b1(0x1ae)+_0x5481ed['patientName']+_0x53c8b1(0x22f),_0x99e90a[_0x53c8b1(0x223)](_0x54d446);}),showModal(_0x134b24(0x185));};window[_0x57cfa9(0x220)]=(_0x23d77c,_0x48c32b)=>{const _0x2f61c3=_0x57cfa9;recordIdToDelete=_0x23d77c,document[_0x2f61c3(0x1c3)](_0x2f61c3(0x190))[_0x2f61c3(0x22b)]=_0x2f61c3(0x1f8)+_0x48c32b+_0x2f61c3(0x209),showModal(_0x2f61c3(0x1f0));};const executeDelete=async()=>{const _0x5585b4=_0x57cfa9;if(!recordIdToDelete)return;try{await deleteDoc(doc(db,_0x5585b4(0x22c),recordIdToDelete)),showMessage(_0x5585b4(0x17e),_0x5585b4(0x20e));}catch(_0x240a31){console['error'](_0x5585b4(0x1ac),_0x240a31),showMessage(_0x5585b4(0x1a3),'red');}finally{closeModal(_0x5585b4(0x1f0)),recordIdToDelete=null,showNoRefillReport();}};window[_0x57cfa9(0x1c2)]=()=>{const _0x4076c8=_0x57cfa9;document['getElementById']('loginForm')[_0x4076c8(0x1df)](_0x4076c8(0x1a0),handleLogin),document[_0x4076c8(0x1c3)](_0x4076c8(0x1f6))['addEventListener'](_0x4076c8(0x1ab),handleLogout),document[_0x4076c8(0x1c3)]('medicationForm')[_0x4076c8(0x1df)](_0x4076c8(0x1a0),handleFormSubmit),[_0x4076c8(0x217),_0x4076c8(0x1db)][_0x4076c8(0x199)](_0x5c4b27=>document[_0x4076c8(0x1c3)](_0x5c4b27)[_0x4076c8(0x1df)]('change',calculateRefillDate)),document['getElementById'](_0x4076c8(0x1f9))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),checkPrescription),document['getElementById'](_0x4076c8(0x200))['addEventListener'](_0x4076c8(0x1ab),filterRecords),document[_0x4076c8(0x1c3)](_0x4076c8(0x228))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),clearSearch),document[_0x4076c8(0x1c3)](_0x4076c8(0x21c))['addEventListener'](_0x4076c8(0x1ab),showNoRefillReport),document['getElementById'](_0x4076c8(0x21f))['addEventListener']('click',()=>closeModal(_0x4076c8(0x1f0))),document['getElementById'](_0x4076c8(0x1b7))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),executeDelete),document['getElementById'](_0x4076c8(0x210))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),()=>closeModal(_0x4076c8(0x1b6))),document[_0x4076c8(0x1c3)](_0x4076c8(0x17d))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),()=>closeModal(_0x4076c8(0x211))),document[_0x4076c8(0x1c3)](_0x4076c8(0x208))[_0x4076c8(0x1df)](_0x4076c8(0x1ab),()=>closeModal('reportModal')),document[_0x4076c8(0x1df)]('keydown',_0x511a2f=>{const _0x439332=_0x4076c8;_0x511a2f[_0x439332(0x196)]===_0x439332(0x1e9)&&[_0x439332(0x1f0),_0x439332(0x185),_0x439332(0x211),'resultsModal'][_0x439332(0x199)](_0x172311=>{const _0x4d7641=_0x439332;if(document[_0x4d7641(0x1c3)](_0x172311)[_0x4d7641(0x19a)][_0x4d7641(0x18e)](_0x4d7641(0x1d5)))closeModal(_0x172311);});});};
    </script>
</head>

<body class="p-4 md:p-8">
    <div id="loginContainer" class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full bg-white p-8 rounded-xl shadow-2xl border">
            <img src="https://i.postimg.cc/HsrDVPzq/logo.png" alt="Logo" class="mx-auto h-16 w-auto mb-4">
            <h2 class="text-3xl font-bold text-center text-blue-800 mb-6">United Pharmacy</h2>
			<h3 class="text-xl font-bold text-center text-gray-800 mb-6">تسجيل الدخول</h3>
            <form id="loginForm">
                <div class="mb-4"><label for="usernameInput" class="block text-sm font-bold mb-1">اسم المستخدم</label><input type="text" id="usernameInput" autocomplete="off" required class="w-full p-3 border rounded-lg" placeholder="أدخل اسم المستخدم"></div>
                <div class="mb-6"><label for="passwordInput" class="block text-sm font-bold mb-1">كلمة المرور</label><input type="password" id="passwordInput" required class="w-full p-3 border rounded-lg" placeholder="••••••••"></div>
                <div id="loginError" class="hidden p-3 mb-4 text-sm rounded-lg bg-red-100 text-red-700"></div>
                <div><button type="submit" class="w-full flex justify-center py-3 px-4 rounded-lg shadow-md text-white bg-blue-600 hover:bg-blue-700">دخول</button></div>
            </form>
            <p class="text-center text-l font-bold text-red-700 mt-7">Created by: Dr.Abdelrahman Baiomy</p>
        </div>
    </div>
    
    <div id="appContainer" class="max-w-4xl mx-auto hidden">
        <header class="text-center mb-8 relative">
            <img src="https://i.postimg.cc/HsrDVPzq/logo.png" alt="Logo" class="mx-auto h-20 w-auto mb-2">
            <h1 class="text-4xl font-bold text-blue-800">United Pharmacy</h1>
			<h1 class="text-l font-bold text-gray-600 mt-6">تتبع صرف علاج وصفتي</h1>
            <div id="userInfo" class="hidden absolute top-0 left-0 flex items-center space-x-2 space-x-reverse text-sm bg-gray-100 p-2 rounded-lg">
                <span class="font-bold">مرحباً, <span id="loggedInUserDisplay" class="font-bold text-blue-600"></span></span>
                <button id="logoutButton" class="text-red-500 hover:text-red-700 font-semibold">تسجيل الخروج</button>
            </div>
        </header>

        <div id="loadingStatus" class="mb-4 text-sm text-center text-gray-600"></div>
        <div id="messageBox" class="hidden p-3 mb-4 text-sm rounded-lg shadow-md"></div>

        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 border">
            <h2 class="text-xl font-semibold text-blue-800 mb-6 border-b pb-2">تسجيل/إعادة صرف</h2>
            <form id="medicationForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="md:col-span-2"><label for="prescriptionNumber" class="block text-sm font-bold mb-1">أدخل رقم الوصفة</label><div class="flex"><input type="text" id="prescriptionNumber" name="prescriptionNumber" required class="flex-grow p-3 border rounded-r-lg" placeholder="أدخل رقم الوصفة"><button type="button" id="checkPrescriptionButton" class="bg-blue-900 text-white p-3 rounded-l-lg hover:bg-blue-700">تحقق</button></div></div>
                <div><label for="patientName" class="block text-sm font-bold mb-1">اسم المريض</label><input type="text" id="patientName" name="patientName" required class="w-full p-3 border rounded-lg" placeholder="الاسم كاملاً"></div>
                <div><label for="idNumber" class="block text-sm font-bold mb-1">رقم الهوية</label><input type="text" id="idNumber" name="idNumber" required class="w-full p-3 border rounded-lg" placeholder="رقم الهوية"></div>
                <div class="md:col-span-2"><label for="phoneNumber" class="block text-sm font-bold mb-1">رقم الهاتف</label><input type="tel" id="phoneNumber" name="phoneNumber" required class="w-full p-3 border rounded-lg text-right" placeholder="رقم الهاتف"></div>
                <div id="medicationInputArea" class="relative md:col-span-2"><label class="block text-sm font-bold mb-1">أضف الأدوية</label><div class="flex"><input type="text" id="medicationSearch" class="flex-grow p-3 border rounded-r-lg" placeholder="ابحث وأضف"><button type="button" id="addMedicationButton" class="bg-blue-900 text-white p-3 rounded-l-lg hover:bg-blue-700">أضف</button></div><div id="medicationSuggestions" class="absolute z-20 w-full bg-white border mt-1 rounded-lg shadow-lg max-h-48 overflow-y-scroll hidden"></div><div id="selectedMedicationsContainer" class="mt-3 p-3 bg-gray-50 border rounded-lg min-h-[40px]"></div><input type="hidden" id="medicationCount" name="medicationCount" value="0"></div>
                <div><label for="dispensingDate" class="block text-sm font-bold mb-1">تاريخ الصرف</label><input type="date" id="dispensingDate" name="dispensingDate" required class="w-full p-3 border rounded-lg"></div>
                <div><label for="refillDuration" class="block text-sm font-bold mb-1">فترة الإعادة</label><select id="refillDuration" name="refillDuration" required class="w-full p-3 border rounded-lg"><option value="" disabled selected>اختر</option><option value="0">لا يوجد اعادة صرف</option><option value="26">شهر</option><option value="52">شهرين</option><option value="78">3 شهور</option></select></div>
                <div class="md:col-span-2"><div class="mt-2 p-3 bg-blue-50 rounded-lg border"><p class="font-bold text-blue-800">تاريخ الإعادة المحسوب:</p><p id="refillDateDisplay" class="font-semibold text-lg">--/--/----</p></div><input type="hidden" id="refillDate" name="refillDate"></div>
                <div class="md:col-span-2 mt-4"><button type="submit" id="submitButton" class="w-full py-3 px-4 rounded-lg shadow-md text-white bg-blue-900 hover:bg-blue-700">حفظ سجل جديد</button></div>
            </form>
        </div>
        
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 border">
            <h2 class="text-xl font-semibold text-blue-800 mb-6 border-b pb-2">البحث بالسجلات</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                <div><label for="startDateFilter" class="block text-sm font-bold mb-1">من تاريخ (إعادة صرف):</label><input type="date" id="startDateFilter" class="w-full p-3 border rounded-lg"></div>
                <div><label for="endDateFilter" class="block text-sm font-bold mb-1">إلى تاريخ (إعادة صرف):</label><input type="date" id="endDateFilter" class="w-full p-3 border rounded-lg"></div>
                <div><label for="generalSearchFilter" class="block text-sm font-bold mb-1">الهوية/الهاتف/الوصفة:</label><input type="text" id="generalSearchFilter" class="w-full p-3 border rounded-lg" placeholder="بحث شامل"></div>
                <div><label for="medicationFilter" class="block text-sm font-bold mb-1">اسم العلاج:</label><input type="text" id="medicationFilter" class="w-full p-3 border rounded-lg" placeholder="مثال: Lantus"></div>
            </div>
             <div class="mt-4 flex flex-col sm:flex-row justify-end gap-2">
                <button id="searchButton" type="button" class="py-3 px-6 rounded-lg shadow-md text-white bg-blue-900 hover:bg-blue-700">بحث</button>
                <button id="clearSearchButton" type="button" class="py-3 px-6 rounded-lg shadow-md text-gray-800 bg-gray-200 hover:bg-gray-300">مسح</button>
            </div>
        </div>
        
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 border">
            <h2 class="text-xl font-semibold text-red-800 mb-6 border-b pb-2">التقارير</h2>
            <div>
                <h3 class="font-bold text-gray-700">تقرير الوصفات المنتهية</h3>
                <p class="text-sm text-gray-500 mb-2">عرض كل الوصفات التي ليس لها إعادة صرف</p>
                <button id="noRefillReportButton" class="py-2 px-5 rounded-lg shadow-md text-white bg-red-600 hover:bg-red-700">عرض التقرير</button>
            </div>
        </div>
        
        <footer class="text-center mt-10 mb-4"><p class="text-l font-bold text-red-700">Created by: Dr.Abdelrahman Baiomy</p></footer>
    </div>
    
    <!-- Modals -->
    <div id="resultsModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col"><div class="p-5 border-b flex justify-between items-center"><h3 class="text-xl font-bold text-blue-700">نتائج البحث</h3><button id="closeModalButton"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="p-5 overflow-y-auto flex-grow"><div class="overflow-x-auto"><table class="min-w-full divide-y"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-6 py-3 text-right text-xs uppercase">المريض</th><th class="px-6 py-3 text-right text-xs uppercase">الهوية</th><th class="px-6 py-3 text-right text-xs uppercase">الهاتف</th><th class="px-6 py-3 text-right text-xs uppercase">الوصفة</th><th class="px-6 py-3 text-right text-xs uppercase">الأدوية</th><th class="px-6 py-3 text-right text-xs uppercase">آخر صرف</th><th class="px-6 py-3 text-right text-xs uppercase">الإعادة</th><th id="createdByHeader" class="px-6 py-3 text-right text-xs uppercase hidden">المسجل</th><th class="px-6 py-3 text-center text-xs uppercase">السجل</th></tr></thead><tbody id="modalRecordsBody" class="divide-y"></tbody></table></div><div id="noResultsModal" class="hidden text-center py-8">لا توجد سجلات.</div></div><div class="p-4 border-t"><button onclick="closeModal('resultsModal')" class="w-full py-2 rounded-lg bg-gray-200 hover:bg-gray-300">إغلاق</button></div></div>
    </div>
    <div id="historyModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-[60] p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] flex flex-col"><div class="p-5 border-b flex justify-between items-center"><h3 class="text-xl font-bold">سجل الصرف: <span id="historyPatientName"></span></h3><button id="closeHistoryModalButton"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="p-5 overflow-y-auto flex-grow"><table class="min-w-full divide-y"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-center text-xs uppercase">#</th><th class="px-4 py-3 text-center text-xs uppercase">تاريخ الصرف</th><th class="px-4 py-3 text-center text-xs uppercase">المدة</th><th class="px-4 py-3 text-center text-xs uppercase">تاريخ الإعادة</th><th class="px-4 py-3 text-right text-xs uppercase">الأدوية</th></tr></thead><tbody id="historyModalBody" class="divide-y"></tbody></table></div><div class="p-4 border-t"><button onclick="closeModal('historyModal')" class="w-full py-2 rounded-lg bg-gray-200 hover:bg-gray-300">إغلاق</button></div></div>
    </div>
    <div id="reportModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col"><div class="p-5 border-b flex justify-between items-center"><h3 class="text-xl font-bold text-red-700">تقرير الوصفات المنتهية</h3><button id="closeReportModalButton"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="p-5 overflow-y-auto flex-grow"><table class="min-w-full divide-y"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-right text-xs uppercase">المريض</th><th class="px-4 py-3 text-right text-xs uppercase">الهوية</th><th class="px-4 py-3 text-right text-xs uppercase">الوصفة</th><th class="px-4 py-3 text-right text-xs uppercase">الأدوية</th><th class="px-4 py-3 text-right text-xs uppercase">آخر صرف</th><th class="px-4 py-3 text-center text-xs uppercase">إجراء</th></tr></thead><tbody id="reportModalBody" class="divide-y"></tbody></table><div id="noResultsReport" class="hidden text-center py-8">لا توجد وصفات منتهية حالياً.</div></div><div class="p-4 border-t"><button onclick="closeModal('reportModal')" class="w-full py-2 rounded-lg bg-gray-200 hover:bg-gray-300">إغلاق</button></div></div>
    </div>
    <div id="confirmDeleteModal" class="fixed inset-0 bg-gray-900 bg-opacity-80 hidden items-center justify-center z-[70] p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <h3 class="text-lg font-bold mb-4">تأكيد الحذف</h3>
            <p id="confirmDeleteMessage" class="text-sm text-gray-600 mb-6">هل أنت متأكد؟</p>
            <div class="flex justify-center gap-4">
                <button id="cancelDeleteButton" class="py-2 px-6 rounded-lg bg-gray-200 hover:bg-gray-300">إلغاء</button>
                <button id="confirmDeleteButton" class="py-2 px-6 rounded-lg bg-red-600 hover:bg-red-700 text-white">تأكيد الحذف</button>
            </div>
        </div>
    </div>
</body>
</html>



